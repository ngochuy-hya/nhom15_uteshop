### ============================================
### üõí QUY TR√åNH ƒê·∫∂T H√ÄNG HO√ÄN CH·ªàNH
### ============================================
### 
### Flow: Th√™m v√†o gi·ªè h√†ng ‚Üí Xem gi·ªè h√†ng ‚Üí T·∫°o ƒë∆°n h√†ng ‚Üí Thanh to√°n ‚Üí Ki·ªÉm tra tr·∫°ng th√°i
###
### H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:
### 1. Thay {{userToken}} b·∫±ng token c·ªßa b·∫°n (l·∫•y t·ª´ login)
### 2. Thay {{productId}} b·∫±ng ID s·∫£n ph·∫©m th·ª±c t·∫ø trong DB
### 3. Thay {{orderId}} b·∫±ng ID ƒë∆°n h√†ng sau khi t·∫°o
### 4. Thay {{orderCode}} b·∫±ng PayOS order code sau khi t·∫°o payment
###
### ============================================

### Variables
@baseUrl = http://localhost:5000/api
@userToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjcsImVtYWlsIjoibmd1eWVuaHV5cG0xQGdtYWlsLmNvbSIsInJvbGVJZCI6MSwiaWF0IjoxNzYxOTY5NDAzLCJleHAiOjE3NjI1NzQyMDN9.AkmseFTAzsuT3bvOsMPn_XSzt1HAxvIHgtxLo9-QC-4
@productId1 = 1
@productId2 = 2
@orderId = 5
@orderCode = 123456789
@cartItemId = 1

### ============================================
### B∆Ø·ªöC 1: ƒêƒÇNG NH·∫¨P (N·∫øu ch∆∞a c√≥ token)
### ============================================

POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "nguyenhuypm1@gmail.com",
  "password": "123456"
}

###
### ‚Üí L∆∞u token t·ª´ response v√†o {{userToken}}
###

### ============================================
### B∆Ø·ªöC 2: XEM GI·ªé H√ÄNG HI·ªÜN T·∫†I
### ============================================

GET {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y gi·ªè h√†ng th√†nh c√¥ng",
###   "data": {
###     "items": [
###       {
###         "id": 1,
###         "product_id": 1,
###         "product_name": "√Åo thun nam",
###         "quantity": 2,
###         "price": 200000,
###         "total": 400000,
###         "selected_color": "ƒê·ªè",
###         "selected_size": "L"
###       }
###     ],
###     "total": 400000,
###     "item_count": 1
###   }
### }
###

### ============================================
### B∆Ø·ªöC 3: TH√äM S·∫¢N PH·∫®M V√ÄO GI·ªé H√ÄNG (L·∫ßn 1)
### ============================================

POST {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "product_id": {{productId1}},
  "quantity": 2,
  "selected_color": "ƒê·ªè",
  "selected_size": "L"
}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "Th√™m v√†o gi·ªè h√†ng th√†nh c√¥ng"
### }
###
### ‚ùå L·ªói n·∫øu:
### - S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i: 404
### - S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho: 400
### - Thi·∫øu product_id ho·∫∑c quantity: 400
###

### ============================================
### B∆Ø·ªöC 4: TH√äM S·∫¢N PH·∫®M V√ÄO GI·ªé H√ÄNG (L·∫ßn 2)
### ============================================

POST {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "product_id": {{productId2}},
  "quantity": 1,
  "selected_color": "Xanh",
  "selected_size": "M"
}

###
### ‚Üí Th√™m s·∫£n ph·∫©m th·ª© 2 v√†o gi·ªè h√†ng
###

### ============================================
### B∆Ø·ªöC 5: XEM GI·ªé H√ÄNG SAU KHI TH√äM
### ============================================

GET {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### ‚Üí Xem t·∫•t c·∫£ s·∫£n ph·∫©m trong gi·ªè h√†ng
### ‚Üí Ghi nh·∫≠n cart_item_id ƒë·ªÉ c·∫≠p nh·∫≠t sau
###

### ============================================
### B∆Ø·ªöC 6: C·∫¨P NH·∫¨T S·ªê L∆Ø·ª¢NG S·∫¢N PH·∫®M
### ============================================

PUT {{baseUrl}}/cart/{{cartItemId}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "quantity": 3
}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "C·∫≠p nh·∫≠t gi·ªè h√†ng th√†nh c√¥ng"
### }
###

### ============================================
### B∆Ø·ªöC 7: X√ìA S·∫¢N PH·∫®M KH·ªéI GI·ªé H√ÄNG (Optional)
### ============================================

DELETE {{baseUrl}}/cart/{{cartItemId}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "X√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng th√†nh c√¥ng"
### }
###

### ============================================
### B∆Ø·ªöC 8: X√ìA T·∫§T C·∫¢ GI·ªé H√ÄNG (Optional)
### ============================================

DELETE {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "X√≥a t·∫•t c·∫£ s·∫£n ph·∫©m trong gi·ªè h√†ng th√†nh c√¥ng"
### }
###

### ============================================
### B∆Ø·ªöC 9: TH√äM L·∫†I S·∫¢N PH·∫®M ƒê·ªÇ T·∫†O ƒê∆†N H√ÄNG
### ============================================

POST {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "product_id": {{productId1}},
  "quantity": 2,
  "selected_color": "ƒê·ªè",
  "selected_size": "L"
}

###
### ‚Üí Th√™m l·∫°i s·∫£n ph·∫©m ƒë·ªÉ c√≥ ƒë·ªß trong gi·ªè h√†ng
###

### ============================================
### B∆Ø·ªöC 10: XEM GI·ªé H√ÄNG L·∫¶N CU·ªêI
### ============================================

GET {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### ‚Üí Ki·ªÉm tra l·∫°i gi·ªè h√†ng tr∆∞·ªõc khi ƒë·∫∑t h√†ng
### ‚Üí L∆∞u th√¥ng tin: product_id, quantity, selected_color, selected_size
###

### ============================================
### B∆Ø·ªöC 11: T·∫†O ƒê∆†N H√ÄNG
### ============================================

POST {{baseUrl}}/orders
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "items": [
    {
      "product_id": {{productId1}},
      "quantity": 2,
      "selected_color": "ƒê·ªè",
      "selected_size": "L"
    },
    {
      "product_id": {{productId2}},
      "quantity": 1,
      "selected_color": "Xanh",
      "selected_size": "M"
    }
  ],
  "shipping_address": {
    "full_name": "Nguy·ªÖn Ng·ªçc Huy",
    "phone": "0327793283",
    "address": "123 ƒê∆∞·ªùng ABC",
    "ward": "Ph∆∞·ªùng 1",
    "district": "Qu·∫≠n 1",
    "city": "H·ªì Ch√≠ Minh",
    "postal_code": "70000"
  },
  "billing_address": {
    "full_name": "Nguy·ªÖn Ng·ªçc Huy",
    "phone": "0327793283",
    "address": "123 ƒê∆∞·ªùng ABC",
    "ward": "Ph∆∞·ªùng 1",
    "district": "Qu·∫≠n 1",
    "city": "H·ªì Ch√≠ Minh",
    "postal_code": "70000"
  },
  "payment_method": "payos",
  "notes": "Giao h√†ng trong gi·ªù h√†nh ch√≠nh",
  "coupon_code": ""
}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "T·∫°o ƒë∆°n h√†ng th√†nh c√¥ng",
###   "data": {
###     "id": 1,
###     "order_number": "UTE-2024-000001",
###     "user_id": 7,
###     "status_id": 1,
###     "subtotal": 400000,
###     "tax_amount": 40000,
###     "shipping_amount": 50000,
###     "discount_amount": 0,
###     "total_amount": 490000,
###     "payment_method": "payos",
###     "payment_status": "pending",
###     "items": [
###       {
###         "id": 1,
###         "product_id": 1,
###         "product_name": "√Åo thun nam",
###         "quantity": 2,
###         "unit_price": 200000,
###         "total_price": 400000
###       }
###     ],
###     "created_at": "2024-11-01T10:30:00Z"
###   }
### }
###
### ‚Üí L∆∞u order_id t·ª´ response ƒë·ªÉ d√πng cho b∆∞·ªõc ti·∫øp theo
###
### ‚ùå L·ªói n·∫øu:
### - S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i: 400
### - S·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho: 400
### - Thi·∫øu ƒë·ªãa ch·ªâ giao h√†ng/thanh to√°n: 400
###

### ============================================
### B∆Ø·ªöC 12: T·∫†O PAYMENT LINK (PayOS)
### ============================================

POST {{baseUrl}}/payment/payos/create
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "order_id": {{orderId}},
  "description": "Thanh to√°n ƒë∆°n h√†ng #UTE-2025-000005"
}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "T·∫°o payment link th√†nh c√¥ng",
###   "data": {
###     "payment_link": "https://pay.payos.vn/web/...",
###     "order_code": 123456789,
###     "qr_code": "https://img.vietqr.io/image/..."
###   }
### }
###
### ‚Üí M·ªü payment_link trong browser ƒë·ªÉ thanh to√°n
### ‚Üí Ho·∫∑c d√πng qr_code ƒë·ªÉ qu√©t thanh to√°n
### ‚Üí L∆∞u order_code ƒë·ªÉ ki·ªÉm tra tr·∫°ng th√°i sau
###

### ============================================
### B∆Ø·ªöC 13: KI·ªÇM TRA TR·∫†NG TH√ÅI THANH TO√ÅN
### ============================================

GET {{baseUrl}}/payment/payos/check/{{orderCode}}
Content-Type: application/json

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y tr·∫°ng th√°i thanh to√°n th√†nh c√¥ng",
###   "data": {
###     "order_code": 123456789,
###     "status": "PAID",
###     "amount": 490000,
###     "paid_at": "2024-11-01T10:35:00Z",
###     "transaction_id": 1,
###     "order": {
###       "id": 1,
###       "order_number": "UTE-2024-000001",
###       "payment_status": "paid",
###       "status_id": 2
###     }
###   }
### }
###
### Tr·∫°ng th√°i c√≥ th·ªÉ l√†:
### - PENDING: Ch·ªù thanh to√°n
### - PAID: ƒê√£ thanh to√°n
### - CANCELLED: ƒê√£ h·ªßy
### - EXPIRED: H·∫øt h·∫°n
###

### ============================================
### B∆Ø·ªöC 14: XEM DANH S√ÅCH ƒê∆†N H√ÄNG C·ª¶A T√îI
### ============================================

GET {{baseUrl}}/orders/my-orders?page=1&limit=10
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### Query Parameters:
### - page: S·ªë trang (default: 1)
### - limit: S·ªë l∆∞·ª£ng/trang (default: 10)
### - status_id: L·ªçc theo tr·∫°ng th√°i (optional)
###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y danh s√°ch ƒë∆°n h√†ng th√†nh c√¥ng",
###   "data": {
###     "orders": [
###       {
###         "id": 1,
###         "order_number": "UTE-2024-000001",
###         "total_amount": 490000,
###         "status_id": 2,
###         "status_name": "processing",
###         "payment_status": "paid",
###         "created_at": "2024-11-01T10:30:00Z"
###       }
###     ],
###     "pagination": {
###       "current_page": 1,
###       "per_page": 10,
###       "total": 1,
###       "total_pages": 1
###     }
###   }
### }
###

### ============================================
### B∆Ø·ªöC 15: XEM CHI TI·∫æT ƒê∆†N H√ÄNG
### ============================================

GET {{baseUrl}}/orders/{{orderId}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y th√¥ng tin ƒë∆°n h√†ng th√†nh c√¥ng",
###   "data": {
###     "id": 1,
###     "order_number": "UTE-2024-000001",
###     "status_id": 2,
###     "status_name": "processing",
###     "subtotal": 400000,
###     "tax_amount": 40000,
###     "shipping_amount": 50000,
###     "total_amount": 490000,
###     "payment_method": "payos",
###     "payment_status": "paid",
###     "shipping_address": {
###       "full_name": "Nguy·ªÖn Ng·ªçc Huy",
###       "phone": "0327793283",
###       "address": "123 ƒê∆∞·ªùng ABC",
###       "city": "H·ªì Ch√≠ Minh"
###     },
###     "items": [
###       {
###         "id": 1,
###         "product_id": 1,
###         "product_name": "√Åo thun nam",
###         "quantity": 2,
###         "unit_price": 200000,
###         "total_price": 400000
###       }
###     ],
###     "created_at": "2024-11-01T10:30:00Z"
###   }
### }
###

### ============================================
### B∆Ø·ªöC 16: XEM H√ìA ƒê∆†N (Invoice)
### ============================================

GET {{baseUrl}}/orders/{{orderId}}/invoice
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y h√≥a ƒë∆°n th√†nh c√¥ng",
###   "data": {
###     "order": {...},
###     "invoice_number": "INV-2024-000001",
###     "invoice_date": "2024-11-01T10:30:00Z"
###   }
### }
###

### ============================================
### B∆Ø·ªöC 17: XEM L·ªäCH S·ª¨ THANH TO√ÅN
### ============================================

GET {{baseUrl}}/payment/my-payments?page=1&limit=10
Content-Type: application/json
Authorization: Bearer {{userToken}}

###
### Query Parameters:
### - page: S·ªë trang (default: 1)
### - limit: S·ªë l∆∞·ª£ng/trang (default: 10)
### - status: L·ªçc theo tr·∫°ng th√°i (pending, completed, failed)
###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y l·ªãch s·ª≠ thanh to√°n th√†nh c√¥ng",
###   "data": {
###     "payments": [
###       {
###         "id": 1,
###         "order_id": 1,
###         "amount": 490000,
###         "status": "completed",
###         "payment_method": "payos",
###         "paid_at": "2024-11-01T10:35:00Z",
###         "order_number": "UTE-2024-000001"
###       }
###     ],
###     "pagination": {...}
###   }
### }
###

### ============================================
### üéâ HO√ÄN T·∫§T QUY TR√åNH ƒê·∫∂T H√ÄNG!
### ============================================
### 
### Quy tr√¨nh ƒë√£ ho√†n t·∫•t:
### ‚úÖ ƒêƒÉng nh·∫≠p
### ‚úÖ Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng
### ‚úÖ Xem v√† qu·∫£n l√Ω gi·ªè h√†ng
### ‚úÖ T·∫°o ƒë∆°n h√†ng
### ‚úÖ T·∫°o payment link
### ‚úÖ Thanh to√°n (qua PayOS)
### ‚úÖ Ki·ªÉm tra tr·∫°ng th√°i thanh to√°n
### ‚úÖ Xem ƒë∆°n h√†ng v√† h√≥a ƒë∆°n
###

### ============================================
### ‚ùå C√ÅC TR∆Ø·ªúNG H·ª¢P L·ªñI V√Ä X·ª¨ L√ù
### ============================================

### Test 1: Th√™m s·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i v√†o gi·ªè h√†ng
POST {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "product_id": 99999,
  "quantity": 1
}

### ‚Üí Expected: 404 Not Found - "S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i ho·∫∑c kh√¥ng kh·∫£ d·ª•ng"

###
### Test 2: Th√™m s·∫£n ph·∫©m v·ªõi s·ªë l∆∞·ª£ng v∆∞·ª£t qu√° t·ªìn kho
POST {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "product_id": {{productId1}},
  "quantity": 999999
}

### ‚Üí Expected: 400 Bad Request - "S·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong kho kh√¥ng ƒë·ªß"

###
### Test 3: T·∫°o ƒë∆°n h√†ng kh√¥ng c√≥ s·∫£n ph·∫©m
POST {{baseUrl}}/orders
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "items": [],
  "shipping_address": {...},
  "billing_address": {...},
  "payment_method": "payos"
}

### ‚Üí Expected: 400 Bad Request - "ƒê∆°n h√†ng ph·∫£i c√≥ √≠t nh·∫•t 1 s·∫£n ph·∫©m"

###
### Test 4: T·∫°o ƒë∆°n h√†ng thi·∫øu ƒë·ªãa ch·ªâ
POST {{baseUrl}}/orders
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "items": [
    {
      "product_id": {{productId1}},
      "quantity": 1
    }
  ],
  "payment_method": "payos"
}

### ‚Üí Expected: 400 Bad Request - "ƒê·ªãa ch·ªâ giao h√†ng v√† thanh to√°n l√† b·∫Øt bu·ªôc"

###
### Test 5: T·∫°o payment link cho ƒë∆°n h√†ng kh√¥ng t·ªìn t·∫°i
POST {{baseUrl}}/payment/payos/create
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "order_id": 99999,
  "description": "Test"
}

### ‚Üí Expected: 404 Not Found - "Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng"

###
### Test 6: H·ªßy ƒë∆°n h√†ng
POST {{baseUrl}}/orders/{{orderId}}/cancel
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "reason": "Kh√¥ng c√≤n mu·ªën mua n·ªØa"
}

### ‚Üí Expected: 200 OK - ƒê∆°n h√†ng ƒë∆∞·ª£c h·ªßy th√†nh c√¥ng
### ‚Üí L∆∞u √Ω: Ch·ªâ c√≥ th·ªÉ h·ªßy ƒë∆°n h√†ng ·ªü tr·∫°ng th√°i pending

###
### Test 7: Y√™u c·∫ßu tr·∫£ h√†ng
POST {{baseUrl}}/orders/{{orderId}}/return
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "reason": "S·∫£n ph·∫©m b·ªã l·ªói",
  "description": "S·∫£n ph·∫©m b·ªã r√°ch khi nh·∫≠n h√†ng"
}

### ‚Üí Expected: 200 OK - Y√™u c·∫ßu tr·∫£ h√†ng ƒë√£ ƒë∆∞·ª£c g·ª≠i

###

