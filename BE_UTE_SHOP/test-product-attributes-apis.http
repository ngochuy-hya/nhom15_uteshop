### ============================================
### üé® PRODUCT ATTRIBUTES APIs TEST
### ============================================
### 
### APIs ƒë·ªÉ qu·∫£n l√Ω thu·ªôc t√≠nh s·∫£n ph·∫©m (size, color, material, style)
###
### H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:
### 1. Thay {{adminToken}} b·∫±ng token c·ªßa admin
### 2. Thay {{productId}} b·∫±ng ID s·∫£n ph·∫©m th·ª±c t·∫ø
### 3. Thay {{attributeId}} b·∫±ng ID attribute sau khi t·∫°o
###
### ============================================

### Variables
@baseUrl = http://localhost:5000/api
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsImVtYWlsIjoiYWRtaW5AdXRlc2hvcC5jb20iLCJyb2xlSWQiOjIsImlhdCI6MTc2MTk3MjYyMiwiZXhwIjoxNzYyNTc3NDIyfQ.BaWPLaD3RLXbnPW51S3bXHfq_hQtmA9uaFZT1ANh1Q4
@productId = 1
@attributeId = 1
@userToken =
### ============================================
### üìã PUBLIC APIs - Xem Attributes
### ============================================

### 1. L·∫•y t·∫•t c·∫£ attributes c·ªßa m·ªôt product
GET {{baseUrl}}/product-attributes/product/{{productId}}
Content-Type: application/json

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y danh s√°ch thu·ªôc t√≠nh s·∫£n ph·∫©m th√†nh c√¥ng",
###   "data": {
###     "attributes": [
###       {
###         "id": 1,
###         "product_id": 1,
###         "attribute_type": "size",
###         "attribute_name": "K√≠ch th∆∞·ªõc",
###         "attribute_value": "L",
###         "price_adjustment": 0,
###         "stock_quantity": 15,
###         "is_active": 1,
###         "created_at": "2024-11-01T10:30:00Z"
###       }
###     ],
###     "total": 7
###   }
### }
###

### ============================================
### 2. L·∫•y m·ªôt attribute theo ID
GET {{baseUrl}}/product-attributes/product/{{productId}}/{{attributeId}}
Content-Type: application/json

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y th√¥ng tin thu·ªôc t√≠nh th√†nh c√¥ng",
###   "data": {
###     "id": 1,
###     "product_id": 1,
###     "attribute_type": "size",
###     "attribute_name": "K√≠ch th∆∞·ªõc",
###     "attribute_value": "L",
###     "price_adjustment": 0,
###     "stock_quantity": 15,
###     "is_active": 1
###   }
### }
###

### ============================================
### 3. L·∫•y attributes theo type (size, color, material, style)
GET {{baseUrl}}/product-attributes/product/{{productId}}/type/size
Content-Type: application/json

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "L·∫•y danh s√°ch thu·ªôc t√≠nh lo·∫°i size th√†nh c√¥ng",
###   "data": {
###     "attributes": [
###       {
###         "id": 1,
###         "attribute_type": "size",
###         "attribute_value": "L",
###         "stock_quantity": 15
###       }
###     ],
###     "type": "size",
###     "total": 4
###   }
### }
###

### ============================================
### üîê ADMIN APIs - CRUD Attributes
### ============================================

### 4. Th√™m attribute m·ªõi cho product
POST {{baseUrl}}/product-attributes/product/{{productId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "attribute_type": "size",
  "attribute_name": "K√≠ch th∆∞·ªõc",
  "attribute_value": "XXL",
  "price_adjustment": 50000,
  "stock_quantity": 20,
  "is_active": true
}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "Th√™m thu·ªôc t√≠nh s·∫£n ph·∫©m th√†nh c√¥ng",
###   "data": {
###     "id": 8,
###     "product_id": 1,
###     "attribute_type": "size",
###     "attribute_name": "K√≠ch th∆∞·ªõc",
###     "attribute_value": "XXL",
###     "price_adjustment": 50000,
###     "stock_quantity": 20,
###     "is_active": true,
###     "product_stock_updated": 95
###   }
### }
###
### ‚Üí product_stock_updated = t·ªïng stock m·ªõi c·ªßa product sau khi th√™m attribute
###

### ============================================
### 5. C·∫≠p nh·∫≠t attribute
PUT {{baseUrl}}/product-attributes/product/{{productId}}/{{attributeId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "attribute_type": "size",
  "attribute_name": "K√≠ch th∆∞·ªõc",
  "attribute_value": "XL",
  "price_adjustment": 30000,
  "stock_quantity": 25,
  "is_active": true
}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "C·∫≠p nh·∫≠t thu·ªôc t√≠nh s·∫£n ph·∫©m th√†nh c√¥ng",
###   "data": {
###     "attribute": {
###       "id": 1,
###       "product_id": 1,
###       "attribute_type": "size",
###       "attribute_value": "XL",
###       "stock_quantity": 25
###     },
###     "product_stock_updated": 100
###   }
### }
###

### ============================================
### 6. X√≥a attribute
DELETE {{baseUrl}}/product-attributes/product/{{productId}}/{{attributeId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "X√≥a thu·ªôc t√≠nh s·∫£n ph·∫©m th√†nh c√¥ng",
###   "data": {
###     "product_stock_updated": 80
###   }
### }
###
### ‚Üí Product stock_quantity s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông c·∫≠p nh·∫≠t = t·ªïng stock t·ª´ c√°c attributes c√≤n l·∫°i
###

### ============================================
### üìä PRODUCT APIs - C·∫≠p nh·∫≠t
### ============================================

### 7. L·∫•y danh s√°ch products (Admin - c√≥ is_active)
GET {{baseUrl}}/products?page=1&limit=20
Content-Type: application/json
Authorization: Bearer {{adminToken}}

###
### ‚úÖ Response cho Admin:
### {
###   "success": true,
###   "data": {
###     "products": [
###       {
###         "id": 1,
###         "name": "√Åo thun nam Nike",
###         "price": 280000,
###         "stock_quantity": 95,
###         "is_active": 1,  ‚Üê Ch·ªâ c√≥ khi l√† admin
###         ...
###       }
###     ]
###   }
### }
###

### ============================================
### 8. T·∫°o s·∫£n ph·∫©m m·ªõi v·ªõi attributes
POST {{baseUrl}}/products
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "√Åo thun nam Nike Dri-FIT",
  "slug": "ao-thun-nam-nike-dri-fit",
  "description": "√Åo thun th·ªÉ thao cao c·∫•p",
  "short_description": "√Åo thun Nike",
  "sku": "NKE-AT-002",
  "price": 350000,
  "sale_price": 300000,
  "category_id": 1,
  "gender": "male",
  "season": "all",
  "brand_id": 1,
  "is_featured": true,
  "attributes": [
    {
      "attribute_type": "size",
      "attribute_name": "K√≠ch th∆∞·ªõc",
      "attribute_value": "S",
      "price_adjustment": 0,
      "stock_quantity": 10,
      "is_active": true
    },
    {
      "attribute_type": "size",
      "attribute_name": "K√≠ch th∆∞·ªõc",
      "attribute_value": "M",
      "price_adjustment": 0,
      "stock_quantity": 15,
      "is_active": true
    },
    {
      "attribute_type": "color",
      "attribute_name": "M√†u s·∫Øc",
      "attribute_value": "ƒêen",
      "price_adjustment": 0,
      "stock_quantity": 20,
      "is_active": true
    },
    {
      "attribute_type": "color",
      "attribute_name": "M√†u s·∫Øc",
      "attribute_value": "Tr·∫Øng",
      "price_adjustment": 0,
      "stock_quantity": 15,
      "is_active": true
    }
  ]
}

###
### ‚úÖ Response th√†nh c√¥ng:
### {
###   "success": true,
###   "message": "T·∫°o s·∫£n ph·∫©m th√†nh c√¥ng",
###   "data": {
###     "id": 10,
###     "name": "√Åo thun nam Nike Dri-FIT",
###     "slug": "ao-thun-nam-nike-dri-fit",
###     "stock_quantity": 60
###   }
### }
###
### ‚Üí stock_quantity = 10 + 15 + 20 + 15 = 60 (t·ª± ƒë·ªông t√≠nh t·ª´ attributes)
###

### ============================================
### üîÑ COMPLETE FLOW TEST
### ============================================

### B∆∞·ªõc 1: Admin t·∫°o s·∫£n ph·∫©m v·ªõi attributes
POST {{baseUrl}}/products
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "Test Product v·ªõi Attributes",
  "price": 500000,
  "category_id": 1,
  "attributes": [
    {
      "attribute_type": "size",
      "attribute_name": "K√≠ch th∆∞·ªõc",
      "attribute_value": "M",
      "stock_quantity": 10
    },
    {
      "attribute_type": "color",
      "attribute_name": "M√†u s·∫Øc",
      "attribute_value": "ƒê·ªè",
      "stock_quantity": 5
    }
  ]
}

### ‚Üí L∆∞u product_id t·ª´ response

###
### B∆∞·ªõc 2: Xem attributes c·ªßa product
GET {{baseUrl}}/product-attributes/product/{{productId}}
Content-Type: application/json

### ‚Üí Ki·ªÉm tra attributes ƒë√£ ƒë∆∞·ª£c t·∫°o

###
### B∆∞·ªõc 3: Th√™m attribute m·ªõi
POST {{baseUrl}}/product-attributes/product/{{productId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "attribute_type": "size",
  "attribute_name": "K√≠ch th∆∞·ªõc",
  "attribute_value": "L",
  "stock_quantity": 8
}

### ‚Üí Product stock s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t = 10 + 5 + 8 = 23

###
### B∆∞·ªõc 4: C·∫≠p nh·∫≠t attribute
PUT {{baseUrl}}/product-attributes/product/{{productId}}/{{attributeId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "stock_quantity": 15
}

### ‚Üí Product stock s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t = 15 + 5 + 8 = 28

###
### B∆∞·ªõc 5: X√≥a attribute
DELETE {{baseUrl}}/product-attributes/product/{{productId}}/{{attributeId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### ‚Üí Product stock s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t = 15 + 8 = 23

###
### B∆∞·ªõc 6: Xem product ƒë·ªÉ ki·ªÉm tra stock ƒë√£ c·∫≠p nh·∫≠t
GET {{baseUrl}}/products/{{productId}}
Content-Type: application/json

### ‚Üí Ki·ªÉm tra stock_quantity = 23

###

### ============================================
### ‚ùå ERROR SCENARIOS
### ============================================

### Test 1: Th√™m attribute v·ªõi attribute_type kh√¥ng h·ª£p l·ªá
POST {{baseUrl}}/product-attributes/product/{{productId}}
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "attribute_type": "invalid_type",
  "attribute_name": "Test",
  "attribute_value": "Value"
}

### ‚Üí Expected: 400 Bad Request - "Lo·∫°i thu·ªôc t√≠nh kh√¥ng h·ª£p l·ªá"

###
### Test 2: Th√™m attribute cho product kh√¥ng t·ªìn t·∫°i
POST {{baseUrl}}/product-attributes/product/99999
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "attribute_type": "size",
  "attribute_name": "Test",
  "attribute_value": "Value"
}

### ‚Üí Expected: 404 Not Found - "Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"

###
### Test 3: C·∫≠p nh·∫≠t attribute kh√¥ng t·ªìn t·∫°i
PUT {{baseUrl}}/product-attributes/product/{{productId}}/99999
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "stock_quantity": 10
}

### ‚Üí Expected: 404 Not Found - "Kh√¥ng t√¨m th·∫•y thu·ªôc t√≠nh"

###
### Test 4: X√≥a attribute kh√¥ng t·ªìn t·∫°i
DELETE {{baseUrl}}/product-attributes/product/{{productId}}/99999
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### ‚Üí Expected: 404 Not Found - "Kh√¥ng t√¨m th·∫•y thu·ªôc t√≠nh"

###
### Test 5: User th∆∞·ªùng c·ªë g·∫Øng t·∫°o attribute (kh√¥ng c√≥ quy·ªÅn admin)
POST {{baseUrl}}/product-attributes/product/{{productId}}
Content-Type: application/json
Authorization: Bearer {{userToken}}

{
  "attribute_type": "size",
  "attribute_name": "Test",
  "attribute_value": "Value"
}

### ‚Üí Expected: 403 Forbidden - "Admin access required"

###

